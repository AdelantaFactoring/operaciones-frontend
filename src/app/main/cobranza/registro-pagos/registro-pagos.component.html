<div class="content-wrapper">
  <div class="content-body">
    <app-content-header [contentHeader]="contentHeader"></app-content-header>
    <core-card #coreCard [actions]="['collapse', 'reload']" (events)="onLimpiarFiltro($event)">
      <h4 class="card-title">Buscar por <small><i>(click aquí para expandir)</i></small></h4>
      <div class="card-body">
        <form [formGroup]="filtroForm">
          <div class="row">
            <div class="col-12">
              <div class="divider divider-success">
                <div class="divider-text">Liquidación - Cabecera</div>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>N° Liquidación</label>
                <input class="form-control" formControlName="codigoLiquidacion" type="text"
                       (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <!--            <div class="col-md-3 col-12">-->
            <!--              <div class="form-group">-->
            <!--                <label>N° Solicitud</label>-->
            <!--                <input class="form-control" formControlName="codigoSolicitud" type="text"-->
            <!--                       (ngModelChange)="onListarCobranza()"/>-->
            <!--              </div>-->
            <!--            </div>-->
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Cliente (RUC o Razón Social)</label>
                <input class="form-control" formControlName="cliente" type="text" (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Pag. / Prov. (RUC o Razón Social)</label>
                <input class="form-control" formControlName="pagadorProveedor" type="text"
                       (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Moneda</label>
                <ng-select appendTo="body" [clearable]="false" [items]="currency" bindLabel="descripcion"
                           placeholder="Moneda" bindValue="valor" formControlName="moneda"
                           (ngModelChange)="onRefrescar()">
                </ng-select>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Tipo Operación</label>
                <ng-select appendTo="body" [clearable]="false" [items]="operationType" bindLabel="descripcion"
                           placeholder="Tipo Operación" bindValue="idColumna" formControlName="tipoOperacion"
                           (ngModelChange)="onRefrescar()">
                </ng-select>
              </div>
            </div>
            <!--            <div class="col-md-4 col-12">-->
            <!--              <div class="form-group">-->
            <!--                <label>Estado</label>-->
            <!--                <ng-select appendTo="body" [clearable]="false" [items]="state" bindLabel="descripcion"-->
            <!--                           [disabled]="(mostrar === 'false' ? true : null)"-->
            <!--                           placeholder="Estado" bindValue="idColumna" formControlName="estado"-->
            <!--                           (ngModelChange)="onListarCobranza()">-->
            <!--                </ng-select>-->
            <!--              </div>-->
            <!--            </div>-->
            <div class="col-12">
              <div class="divider divider-warning">
                <div class="divider-text">Liquidación - Detalle</div>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Pag. / Prov. (RUC o Razón Social)</label>
                <input class="form-control" formControlName="pagadorProveedorDet" type="text"
                       (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>N° Documento</label>
                <input class="form-control" formControlName="nroDocumento" type="text"
                       (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label>Neto Confirmado</label>
                <input class="form-control" formControlName="netoConfirmado" type="text"
                       mask="separator" thousandSeparator="," (ngModelChange)="onRefrescar()"/>
              </div>
            </div>
            <div class="col-md-6 col-12">
              <div class="form-group">
                <label>Fecha Confirmada (Desde)</label>
                <div class="input-group">
                  <input class="form-control" placeholder="yyyy-mm-dd"
                         formControlName="fechaConfirmadaDesde" container="body"
                         ngbDatepicker #basicDP="ngbDatepicker" (ngModelChange)="onRefrescar()">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary feather icon-x"
                            (click)="onCambioFechaConfirmada(true)"
                            type="button" rippleEffect></button>
                  </div>
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary feather icon-calendar"
                            (click)="basicDP.toggle()"
                            type="button" rippleEffect></button>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-12">
              <div class="form-group">
                <label>Fecha Confirmada (Hasta)</label>
                <div class="input-group">
                  <input class="form-control" placeholder="yyyy-mm-dd"
                         formControlName="fechaConfirmadaHasta" container="body"
                         ngbDatepicker #basicDP1="ngbDatepicker" (ngModelChange)="onRefrescar()">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary feather icon-x"
                            (click)="onCambioFechaConfirmada(false)"
                            type="button" rippleEffect></button>
                  </div>
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary feather icon-calendar"
                            (click)="basicDP1.toggle()"
                            type="button" rippleEffect></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </core-card>
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="d-flex flex-wrap mb-0">
            <div class="p-1">
              <button type="submit" rippleEffect class="btn btn-secondary" (click)="onRefrescar()">
                <i class="mr-0 mr-sm-1" data-feather="refresh-cw"></i>
                <span class="d-none d-sm-inline-block">Refrescar</span>
              </button>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-12">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <label class="d-flex align-items-center"
              >Mostrar
                <select class="form-control mx-25" [(ngModel)]="pageSize" [ngModelOptions]="{ standalone: true }"
                        (change)="onListarCobranza()">
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
                filas</label
              >
            </div>
          </div>
          <div class="col-md-6 col-12 d-flex justify-content-md-end">
            <div class="d-flex align-items-center justify-content-end mb-1">
              <label class="d-flex align-items-center"
              >Buscar<input
                type="search"
                placeholder="Buscar"
                class="form-control ml-25"
                [(ngModel)]="search" [ngModelOptions]="{ standalone: true }" (change)="onBuscar()"
              /></label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="table-responsive">
              <table class="table table-hover min-width-table">
                <thead class="centerall-header">
                <tr>
                  <th rowspan="2">
                    <div class="d-flex align-items-center">
                      <a href="javascript:void(0)" title="Ocultar / Mostrar"
                         (click)="onCambiarVisibilidadDetalleTodo()">
                        <div *ngIf="!cambiarIcono">
                          <i class="text-primary cursor-pointer" data-feather="chevron-right"></i>
                        </div>
                        <div *ngIf="cambiarIcono"><i class="text-primary cursor-pointer"
                                                     data-feather="chevron-down"></i>
                        </div>
                      </a>
                    </div>
                  </th>
                  <th rowspan="2" style="width: 5px">Acción</th>
                  <th rowspan="2" style="width: 200px">N° Liquidación</th>
                  <!--                  <th rowspan="2">N° Solicitud</th>-->
                  <th rowspan="2">Cliente</th>
                  <!--                  <th rowspan="2">Cliente RUC</th>-->
                  <th rowspan="2">Pagador / Proveedor</th>
                  <!--                  <th rowspan="2">Pagador / Proveedor RUC</th>-->
                  <th rowspan="2">Moneda</th>
                  <th rowspan="2">Neto Confirmado Total</th>
                  <th rowspan="2">IGV restante total (servicio)</th>
                  <th rowspan="2">Pago Total (Capital)</th>
                  <th rowspan="2">Saldo Deuda Total (Capital)</th>
                  <th rowspan="2">Pago Total</th>
                  <th rowspan="2">Saldo Deuda Total</th>
                  <!--                  <th rowspan="2">Estado</th>-->
                  <!--                  <th rowspan="2">¿Intereses y <br> gastos-->
                  <!--                    pagados? <br> (Confirming)-->
                  <!--                  </th>-->
                  <th colspan="4" class="audit-columns">Auditoría</th>
                </tr>
                <tr>
                  <th class="audit-columns">Creado por</th>
                  <th class="audit-columns">Fecha creación</th>
                  <th class="audit-columns">Modificado por</th>
                  <th class="audit-columns">Fecha modificación</th>
                </tr>
                </thead>
                <tbody>
                <tr class="sumatoria" *ngIf="cobranza.length > 1">
                  <td [colSpan]="6"><i>Total:</i></td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.netoConfirmadoTotal | number: '1.2-2'}}</i>
                  </td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.interesRestanteServicioTotal | number: '1.2-2'}}</i>
                  </td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.pagoTotal | number: '1.2-2'}}</i>
                  </td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.saldoTotal | number: '1.2-2'}}</i>
                  </td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.pagoCompletoTotal | number: '1.2-2'}}</i>
                  </td>
                  <td>
                    <span *ngIf="sumatoriaLoading" class="spinner-border spinner-border-sm mr-1"></span>
                    <i *ngIf="!sumatoriaLoading">{{sumatoria.saldoCompletoTotal | number: '1.2-2'}}</i>
                  </td>
                  <td [colSpan]="4"></td>
                </tr>
                <ng-template let-cab ngFor [ngForOf]="cobranza">
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <a href="javascript:void(0)" title="Ocultar / Mostrar"
                           (click)="onCambiarVisibilidadDetalle(cab)">
                          <div *ngIf="!cab.cambiarIcono">
                            <i class="text-primary cursor-pointer" data-feather="chevron-right"></i>
                          </div>
                          <div *ngIf="cab.cambiarIcono"><i class="text-primary cursor-pointer"
                                                           data-feather="chevron-down"></i>
                          </div>
                        </a>
                      </div>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <a href="javascript:void(0)" title="Inicio de pagos por factura"
                           (click)="onShowInicioPagos(modalInicioPagos, cab)"
                           [class.disabled]="!(cab.idTipoOperacion == 1 && !cab.alterno)"
                           class="btn btn-raised btn-outline-primary btn-sm">
                          <i class="text-primary cursor-pointer" data-feather="toggle-left"></i>
                        </a>
                        &nbsp;
                        <a href="javascript:void(0)"
                           title="Registro de pago de intereses y gastos por servicio (Confirming)"
                           (click)="onShowPAI(modalPAI, cab)"
                           [class.disabled]="cab.idTipoOperacion != 3"
                           class="btn btn-raised btn-outline-secondary btn-sm">
                          <i class="text-secondary cursor-pointer" data-feather="credit-card"></i>
                        </a>
                      </div>
                    </td>
                    <td style="text-align: center">
                      <div class="cell-line-height">
                        <p class="mb-0">
                          {{cab.codigo}}
                        </p>
                        <span class="text-muted font-small-3">{{cab.tipoOperacion}}</span>
                        <div class="progress-wrapper" style="text-align: center">
                          <ngb-progressbar [striped]="true" [animated]="true" type="primary"
                                           [value]="porcentajePagoTotal(cab.porcentajePagoTotal)"></ngb-progressbar>
                          <span style="font-size: 12px">{{porcentajePagoTotal(cab.porcentajePagoTotal)}}%</span>
                        </div>
                      </div>
                    </td>
                    <!--                    <td>-->
                    <!--                      <div class="cell-line-height">-->
                    <!--                        <p class="mb-25">-->
                    <!--                          {{cab.codigoSolicitud}}-->
                    <!--                        </p>-->
                    <!--                        <span class="text-muted font-small-3">{{cab.tipoOperacion}}</span>-->
                    <!--                      </div>-->
                    <!--                    </td>-->
                    <td>{{cab.razonSocialCliente}}</td>
                    <!--                    <td>{{cab.rucCliente}}</td>-->
                    <td>{{cab.razonSocialPagProv}}</td>
                    <!--                    <td>{{cab.rucPagProv}}</td>-->
                    <td>{{cab.moneda}}</td>
                    <td>{{cab.netoConfirmadoTotal | number: '1.2-2'}}</td>
                    <td>{{cab.interesRestanteServicioTotal | number: '1.2-2'}}</td>
                    <td>{{cab.pagoTotal | number: '1.2-2'}}</td>
                    <td>{{saldo(cab.saldoTotal) | number: '1.2-2'}}</td>
                    <td>{{cab.pagoCompletoTotal | number: '1.2-2'}}</td>
                    <td>{{saldo(cab.saldoCompletoTotal) | number: '1.2-2'}}</td>
                    <!--                    <td>{{cab.estado}}</td>-->
                    <!--                    <td>{{(cab.idTipoOperacion == 3) ? ((cab.flagPagoInteresConfirming) ? 'Sí' : 'No') : '-'}}</td>-->
                    <td>{{cab.usuarioCreacion}}</td>
                    <td>{{cab.fechaCreacion}}</td>
                    <td>{{cab.usuarioModificacion}}</td>
                    <td>{{cab.fechaModificacion}}</td>
                  </tr>
                  <tr id="{{ 'trL' + cab.idLiquidacionCab }}" style="visibility: collapse">
                    <td [colSpan]="17">
                      <div class="row" *ngIf="mostrar === 'true'">
                        <div class="d-flex flex-wrap mb-0">
                          <div class="p-1">
                            <button type="submit" rippleEffect class="btn btn-success" (click)="onPagoMasivo(cab)">
                              <i class="mr-0 mr-sm-1" data-feather="save"></i>
                              <span class="d-none d-sm-inline-block">Iniciar Pago Masivo</span>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="table-responsive"
                             style="padding-left: 20px; display: none; max-height: 300px; overflow-x: hidden"
                             id="{{ 'detailL' + cab.idLiquidacionCab }}">
                          <table class="table table-hover">
                            <thead>
                            <tr>
                              <th *ngIf="mostrar === 'true'" class="detail-th-color" style="width: 81px">
                                <div class="custom-control custom-checkbox">
                                  <input type="checkbox" class="custom-control-input"
                                         id="{{'customCheck' + cab.idLiquidacionCab}}" unchecked
                                         [(ngModel)]="cab.seleccionarTodo" (ngModelChange)="onSeleccionarTodo(cab)"/>
                                  <label class="custom-control-label"
                                         for="{{'customCheck' + cab.idLiquidacionCab}}"></label>
                                </div>
                              </th>
                              <th *ngIf="cab.verOpcionesPagoDetalle && mostrar === 'true'" style="width: 220px"
                                  class="detail-th-color">Fecha Pago
                              </th>
                              <th *ngIf="cab.verOpcionesPagoDetalle && mostrar === 'true'" style="width: 206px"
                                  class="detail-th-color">Monto Pago
                              </th>
                              <th class="detail-th-color">Acción</th>
                              <th class="detail-th-color">Progreso Pago</th>
                              <th *ngIf="cab.idTipoOperacion === 3" class="detail-th-color">Proveedor</th>
<!--                              <th *ngIf="cab.idTipoOperacion === 3" class="detail-th-color">Proveedor RUC</th>-->
                              <th class="detail-th-color">N° Documento</th>
                              <th class="detail-th-color">Fecha Confirmada</th>
                              <th class="detail-th-color">Neto Confirmado</th>
                              <th *ngIf="cab.flagAdelanto" class="detail-th-color">Neto Confirmado Total</th>
                              <th class="detail-th-color">IGV restante (servicio)</th>
                              <th class="detail-th-color">Día(s) Mora</th>
                              <th class="detail-th-color">Pago (Capital)</th>
                              <th class="detail-th-color">Interés Mora</th>
                              <th class="detail-th-color">Gastos Mora</th>
                              <th class="detail-th-color">Pago Total</th>
                              <th class="detail-th-color">Saldo Deuda (Capital)</th>
                              <th class="detail-th-color">Saldo Deuda Total</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="sumatoria" *ngIf="cab.liquidacionDet.length > 1">
                              <td [colSpan]="
                                  cab.idTipoOperacion === 3 && cab.verOpcionesPagoDetalle && mostrar === 'true' ? 8 :
                                  cab.idTipoOperacion === 3 && !cab.verOpcionesPagoDetalle && mostrar === 'true' ? 6 :
                                  cab.idTipoOperacion !== 3 && cab.verOpcionesPagoDetalle && mostrar === 'true' ? 7 :
                                  cab.idTipoOperacion !== 3 && !cab.verOpcionesPagoDetalle && mostrar === 'true' ? 5 :
                                  cab.idTipoOperacion === 3 && !cab.verOpcionesPagoDetalle && mostrar !== 'true' ? 5 :
                                  cab.idTipoOperacion !== 3 && !cab.verOpcionesPagoDetalle && mostrar !== 'true' ? 4 : 0
                                "><i>Total:</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'netoConfirmado') | number: '1.2-2'}}</i></td>
                              <td *ngIf="cab.flagAdelanto">
                                <i>{{onSumatoria(cab.liquidacionDet, 'netoConfirmadoOriginal') | number: '1.2-2'}}</i>
                              </td>
                              <td>
                                <i>{{onSumatoria(cab.liquidacionDet, 'interesRestanteServicio') | number: '1.2-2'}}</i>
                              </td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'diasMora') | number: '1.0'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'pago') | number: '1.2-2'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'interesPago') | number: '1.2-2'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'gastosPago') | number: '1.2-2'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'pagoCompleto') | number: '1.2-2'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'saldo') | number: '1.2-2'}}</i></td>
                              <td><i>{{onSumatoria(cab.liquidacionDet, 'saldoCompleto') | number: '1.2-2'}}</i></td>
                            </tr>
                            <tr *ngFor="let item of cab.liquidacionDet">
                              <td *ngIf="mostrar === 'true'">
                                <div class="custom-control custom-checkbox">
                                  <input type="checkbox" class="custom-control-input"
                                         id="{{'customCheck' + item.idLiquidacionDet}}"
                                         [disabled]="item.pagoTotal || (cab.idTipoOperacion == 1 && !cab.alterno && !item.flagPagoHabilitado)
                                                    || (cab.idTipoOperacion == 3 && !cab.flagPagoInteresConfirming)"
                                         [(ngModel)]="item.seleccionado" (ngModelOptions)="{ standalone: true }"
                                         (ngModelChange)="onSeleccionado(cab, item)"/>
                                  <label class="custom-control-label"
                                         for="{{'customCheck' + item.idLiquidacionDet}}"></label>
                                </div>
                              </td>
                              <td *ngIf="mostrar === 'true' && cab.verOpcionesPagoDetalle">
                                <div *ngIf="item.verOpcionesPago" class="input-group">
                                  <input class="form-control" placeholder="yyyy-mm-dd" container="body"
                                         style="width: 50px"
                                         [maxDate]="fechaMaxima"
                                         [(ngModel)]="item.fechaPago"
                                         [ngClass]="{ 'is-invalid': item.fechaPago === null }"
                                         ngbDatepicker #basicDP2="ngbDatepicker">
                                  <div class="input-group-append">
                                    <button class="btn btn-outline-secondary feather icon-calendar"
                                            (click)="basicDP2.toggle()"
                                            type="button" rippleEffect></button>
                                  </div>
                                </div>
                              </td>
                              <td *ngIf="mostrar === 'true' && cab.verOpcionesPagoDetalle">
                                <input *ngIf="item.verOpcionesPago" class="form-control" type="text"
                                       [(ngModel)]="item.montoPago" placeholder="0.00" style="width: 150px"
                                       [ngClass]="{ 'is-invalid': item.montoPago <= 0 }" mask="separator"
                                       thousandSeparator=","/>
                              </td>
                              <td>
                                <div class="d-flex align-items-center">
                                  <a *ngIf="cab.idEstado != 7 && !item.pagoTotal" href="javascript:void(0)"
                                     title="Pagar"
                                     [class.disabled]="cab.verOpcionesPagoDetalle ? true : null"
                                     (click)="onPagar(modalINFO, cab, item)"
                                     class="btn btn-raised btn-outline-success btn-sm">
                                    <i class="text-success cursor-pointer" data-feather="edit"></i>
                                  </a>
                                  <a *ngIf="cab.idEstado === 7 || item.pagoTotal" href="javascript:void(0)"
                                     title="Ver Pagos"
                                     (click)="onPagar(modalINFO, cab, item)"
                                     class="btn btn-raised btn-outline-info btn-sm">
                                    <i class="text-info cursor-pointer" data-feather="eye"></i>
                                  </a>
                                </div>
                              </td>
                              <td>
                                <div class="progress-wrapper">
                                  <div class="mb-25 text-center">{{porcentajePagoTotal(item.porcentajePago)}}%</div>
                                  <ngb-progressbar [striped]="true" [animated]="true" type="primary"
                                                   [value]="porcentajePagoTotal(item.porcentajePago)"></ngb-progressbar>
                                </div>
                              </td>
                              <td *ngIf="cab.idTipoOperacion === 3"
                                  [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.razonSocialPagProv}}</td>
<!--                              <td *ngIf="cab.idTipoOperacion === 3"-->
<!--                                  [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.rucPagProv}}</td>-->
                              <td [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.nroDocumento}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.fechaConfirmado}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.netoConfirmado | number: '1.2-2'}}</td>
                              <td *ngIf="cab.flagAdelanto"
                                  [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.netoConfirmadoOriginal | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.interesRestanteServicio | number: '1.2-2'}}</td>
                              <td [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.diasMora}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.pago | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.interesPago | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.gastosPago | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{item.pagoCompleto | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{saldo(item.saldo) | number: '1.2-2'}}</td>
                              <td
                                [ngClass]="{'progreso-td-color': item.porcentajePago > 0}">{{saldo(item.saldoCompleto) | number: '1.2-2'}}</td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </td>
                  </tr>
                </ng-template>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-md-12 d-flex justify-content-end mt-1">
            <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" (pageChange)="onListarCobranza()"
                            [maxSize]="3" [rotate]="false" [boundaryLinks]="true" [pageSize]="pageSize"
                            [ellipses]="false">
              <ng-template ngbPaginationFirst>
                <span [data-feather]="'chevrons-left'" [size]="18" [class]="'font-weight-bolder'"></span>
              </ng-template>
              <ng-template ngbPaginationPrevious>
                <span [data-feather]="'chevron-left'" [size]="18" [class]="'font-weight-bolder'"></span>
              </ng-template>
              <ng-template ngbPaginationNext>
                <span [data-feather]="'chevron-right'" [size]="18" [class]="'font-weight-bolder'"></span>
              </ng-template>
              <ng-template ngbPaginationLast>
                <span [data-feather]="'chevrons-right'" [size]="18" [class]="'font-weight-bolder'"></span>
              </ng-template>
            </ngb-pagination>
          </div>
        </div>

        <ng-template #modalINFO let-modal>
          <div class="modal-header">
            <h4 class="modal-title">Liquidación: [{{codigo}}] => N° Documento: [{{nroDocumento}}]</h4>
            <button aria-label="Close" class="close" type="button" (click)="onCancelarPago()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" ngbAutofocus tabindex="0">
            <form [formGroup]="liquidacionForm">
              <div class="row spaced">
                <div class="col-12">
                  <div class="divider divider-info">
                    <div class="divider-text">Información General</div>
                  </div>
                </div>
                <div class="col-md-12 col-12" hidden>
                  <div class="form-group">
                    <label>Id</label>
                    <input class="form-control" formControlName="idLiquidacionCab" type="text"/>
                  </div>
                </div>
                <div class="col-md-12 col-12" hidden>
                  <div class="form-group">
                    <label>Id</label>
                    <input class="form-control" formControlName="idLiquidacionDet" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>RUC (Cliente)</label>
                    <input class="form-control" formControlName="rucCliente" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Razón Social (Cliente)</label>
                    <input class="form-control" formControlName="razonSocialCliente" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>RUC (Proveedor / Pagador)</label>
                    <input class="form-control" formControlName="rucPagProv" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Razón Social (Proveedor / Pagador)</label>
                    <input class="form-control" formControlName="razonSocialPagProv" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>N° Documento</label>
                    <input class="form-control" formControlName="nroDocumento" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Fecha Confirmada</label>
                    <input class="form-control" formControlName="fechaConfirmada" type="text"/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Neto Confirmado</label>
                    <input class="form-control" formControlName="netoConfirmado" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-6 col-12" *ngIf="liquidacionCabItem.flagAdelanto">
                  <div class="form-group">
                    <label>Neto Confirmado Total</label>
                    <input class="form-control" formControlName="netoConfirmadoOriginal" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-6 col-12"
                     *ngIf="liquidacionCabItem.idTipoOperacion == 1 && !liquidacionCabItem.alterno">
                  <div class="form-group">
                    <label>IGV restante (servicio)</label>
                    <input class="form-control" formControlName="interesRestanteServicio" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Fondo Resguardo</label>
                    <input class="form-control" formControlName="fondoResguardo" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-6 col-12" *ngIf="liquidacionCabItem.flagAdelanto">
                  <div class="form-group">
                    <label>Fondo Resguardo Total</label>
                    <input class="form-control" formControlName="fondoResguardoOriginal" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
              </div>
            </form>
            <form [formGroup]="pagoInfoForm">
              <div class="row spaced" [hidden]="ocultarPagoForm">
                <div class="col-12">
                  <div class="divider divider-success">
                    <div class="divider-text">Información de Pago</div>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Fecha Confirmada</label>
                    <input class="form-control" formControlName="nuevaFechaConfirmada" type="text"/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Fecha Pago Cálculo</label>
                    <div class="input-group">
                      <input class="form-control" placeholder="yyyy-mm-dd" formControlName="fecha"
                             (ngModelChange)="onCambioFecha($event)"
                             container="body" ngbDatepicker #basicDP="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary feather icon-calendar"
                                (click)="basicDP.toggle()"
                                type="button" rippleEffect></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Día(s) Mora</label>
                    <input class="form-control" formControlName="diasMora" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Interés</label>
                    <input class="form-control" formControlName="interes" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Gastos</label>
                    <input class="form-control" formControlName="gastos" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Saldo (Deuda)</label>
                    <input class="form-control" formControlName="saldoDeuda" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <!--                <div class="col-md-4 col-12" *ngIf="liquidacionDetItem.fondoResguardo > 0">-->
                <!--                  <div class="form-group">-->
                <!--                    <label>Descuento de F.R.</label>-->
                <!--                    <input class="form-control" disabled formControlName="descuentoFR" type="text"-->
                <!--                           mask="separator" thousandSeparator=","/>-->
                <!--                  </div>-->
                <!--                </div>-->
                <div class="col-12 col-md-4">
                  <div class="form-group">
                    <label>Tipo de Pago</label>
                    <div class="form-control custom-control custom-switch custom-control-inline"
                         style="border: 0px; background-color: transparent">
                      <label style="padding-right: 0.5rem; line-height: 1.7rem">Parcial</label>
                      <input type="checkbox" readonly class="custom-control-input"
                             id="tipoPago" formControlName="tipoPago" (ngModelChange)="onCambioTipoPago($event)"
                      />
                      <label class="custom-control-label"
                             for="tipoPago">Total</label>
                    </div>
                  </div>
                </div>
                <div class="col-12" *ngIf="liquidacionCabItem.idTipoOperacion == 1 && !liquidacionCabItem.alterno">
                  <div class="row">
                    <div class="col-12">
                      <div class="divider divider-success">
                        <div class="divider-text">Grupo extra (Factoring Regular)</div>
                      </div>
                    </div>
                    <div class="col-12 col-md-4">
                      <div class="form-group">
                        <label>¿Quién inició los pagos?</label>
                        <div class="form-control custom-control custom-switch custom-control-inline"
                             style="border: 0px; background-color: transparent">
                          <label style="padding-right: 0.5rem; line-height: 1.7rem">Pagador</label>
                          <input disabled type="checkbox" class="custom-control-input"
                                 id="flagInicioCliente" formControlName="flagInicioCliente"/>
                          <label class="custom-control-label"
                                 for="flagInicioCliente">Cliente</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="divider divider-success">
                    <div class="divider-text"><span [data-feather]="'chevrons-down'"></span></div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label>Tipo de Registro</label>
                    <div class="form-control custom-control custom-switch custom-control-inline"
                         style="border: 0px; background-color: transparent">
                      <label style="padding-right: 0.5rem; line-height: 1.7rem">Estándar</label>
                      <input type="checkbox" readonly class="custom-control-input"
                             id="tipoRegistro" formControlName="tipoRegistro"
                             (ngModelChange)="onCambioTipoRegistro($event)"
                      />
                      <label class="custom-control-label"
                             for="tipoRegistro">Personalizado</label>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div *ngIf="pagoPersonalizado">
                    <ngb-alert [type]="'warning'"
                               [dismissible]="false">
                      <div class="alert-body" style="font-size: 13px !important;">
                        <i [data-feather]="'alert-triangle'"></i> El pago personalizado es considerado como pago final,
                        no permite registrar pago parcial.
                      </div>
                    </ngb-alert>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Fecha de Pago</label>
                    <div class="input-group">
                      <input class="form-control" placeholder="yyyy-mm-dd" formControlName="fechaPago"
                             [minDate]="fechaMinima" [maxDate]="fechaMaxima"
                             [ngClass]="{ 'is-invalid': submitted && ReactiveIUForm.fechaPago.errors }"
                             container="body" ngbDatepicker #basicDP1="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary feather icon-calendar"
                                (click)="basicDP1.toggle()"
                                type="button" rippleEffect></button>
                      </div>
                      <div *ngIf="ReactiveIUForm.fechaPago.errors" class="invalid-feedback">
                        <div *ngIf="ReactiveIUForm.fechaPago.errors?.required">* Campo obligatorio</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Monto a Pagar</label>
                    <input class="form-control" formControlName="montoPago" type="text"
                           [ngClass]="{ 'is-invalid': submitted && ReactiveIUForm.montoPago.errors }"
                           mask="separator" thousandSeparator=","
                           (ngModelChange)="onMontoPagoCambiar($event)"/>
                    <div *ngIf="ReactiveIUForm.montoPago.errors" class="invalid-feedback">
                      <div *ngIf="ReactiveIUForm.montoPago.errors?.required">* Campo obligatorio</div>
                      <div *ngIf="ReactiveIUForm.montoPago.errors?.min">* El valor debe ser mayor a 0</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-12" *ngIf="pagoPersonalizado">
                  <div class="form-group">
                    <label>Interés a Pagar</label>
                    <input class="form-control" formControlName="interesPago" type="text"
                           [ngClass]="{ 'is-invalid': submitted && ReactiveIUForm.interesPago.errors }"
                           mask="separator" thousandSeparator=","
                           (ngModelChange)="onMontoPagoCambiar($event)"/>
                    <div *ngIf="ReactiveIUForm.interesPago.errors" class="invalid-feedback">
                      <div *ngIf="ReactiveIUForm.interesPago.errors?.required">* Campo obligatorio</div>
                      <div *ngIf="ReactiveIUForm.interesPago.errors?.min">* El valor debe ser mayor o igual a 0</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-12" *ngIf="pagoPersonalizado">
                  <div class="form-group">
                    <label>Gastos a Pagar</label>
                    <input class="form-control" formControlName="gastosPago" type="text"
                           [ngClass]="{ 'is-invalid': submitted && ReactiveIUForm.gastosPago.errors }"
                           mask="separator" thousandSeparator=","
                           (ngModelChange)="onMontoPagoCambiar($event)"/>
                    <div *ngIf="ReactiveIUForm.gastosPago.errors" class="invalid-feedback">
                      <div *ngIf="ReactiveIUForm.gastosPago.errors?.required">* Campo obligatorio</div>
                      <div *ngIf="ReactiveIUForm.gastosPago.errors?.min">* El valor debe ser mayor o igual a 0</div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label>Observación</label>
                    <textarea class="form-control" type="text" formControlName="observacion"
                              maxlength="200"></textarea>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <button
                      [disabled]="((liquidacionCabItem.idTipoOperacion == 1 && !liquidacionCabItem.alterno) ? !pagoInfoForm.controls.flagPagoHabilitado.value : false) || (liquidacionCabItem.idTipoOperacion == 3 && !liquidacionCabItem.flagPagoInteresConfirming)"
                      type="submit" class="btn btn-success" (click)="onGuardarPago()">
                      <i class="mr-0 mr-sm-1" data-feather="save"></i>
                      <span class="d-none d-sm-inline-block">Guardar</span>
                    </button>
                  </div>
                </div>
                <div class="col-12">
                  <div *ngIf="liquidacionCabItem.idTipoOperacion == 3">
                    <ngb-alert *ngIf="!liquidacionCabItem.flagPagoInteresConfirming" [type]="'danger'"
                               [dismissible]="false">
                      <div class="alert-body" style="font-size: 13px !important;">
                        * Aun no se puede iniciar con los pagos (debe confirmar si se pagó los intereses y
                        gastos
                        (servicio)).
                      </div>
                    </ngb-alert>
                    <ngb-alert *ngIf="liquidacionCabItem.flagPagoInteresConfirming" [type]="'success'"
                               [dismissible]="false">
                      <div class="alert-body" style="font-size: 13px !important;">
                        * Se puede iniciar / continuar con los pagos.
                      </div>
                    </ngb-alert>
                  </div>
                  <div *ngIf="liquidacionCabItem.idTipoOperacion == 1 && !liquidacionCabItem.alterno">
                    <ngb-alert *ngIf="!pagoInfoForm.controls.flagPagoHabilitado.value" [type]="'danger'"
                               [dismissible]="false">
                      <div class="alert-body" style="font-size: 13px !important;">
                        * Aun no se puede iniciar con los pagos (debe indicar quién inicia los pagos en la
                        opción de
                        la grilla principal).
                      </div>
                    </ngb-alert>
                    <ngb-alert *ngIf="pagoInfoForm.controls.flagPagoHabilitado.value" [type]="'success'"
                               [dismissible]="false">
                      <div class="alert-body" style="font-size: 13px !important;">
                        * Se puede iniciar / continuar con los pagos.
                      </div>
                    </ngb-alert>
                  </div>
                </div>
              </div>
            </form>
            <div class="row">
              <div class="col-12">
                <div class="divider divider-warning">
                  <div class="divider-text">Pagos</div>
                </div>
              </div>
              <div class="col-12">
                <p style="text-align: right"><i class="text-success cursor-pointer fa fa-check"></i> : Generado &nbsp;&nbsp;
                  <i class="text-danger cursor-pointer fa fa-ban"></i> : No Generado &nbsp;&nbsp;
                  <i class="text-secondary cursor-pointer fa fa-minus-circle"></i> : No Requerido</p>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead class="centerall-header">
                    <tr>
                      <th rowspan="2">Acción</th>
                      <th rowspan="2">N°</th>
                      <th rowspan="2">Fecha Confirmada</th>
                      <th rowspan="2">Fecha Pago</th>
                      <th rowspan="2">Día(s) Mora</th>
                      <th rowspan="2">Monto a Financiar</th>
                      <th rowspan="2">Monto Pago</th>
                      <th rowspan="2">Interés</th>
                      <th rowspan="2">Gastos</th>
                      <th rowspan="2">Saldo (Deuda)</th>
                      <th rowspan="2">Exceso</th>
                      <th rowspan="2">Tipo de Pago</th>
                      <th rowspan="2">Observación</th>
                      <th rowspan="2">¿FACTURA GENERADA? (INTERÉS MORA)</th>
                      <th rowspan="2">¿FACTURA GENERADA? (GASTOS MORA)</th>
                      <th colspan="2" class="audit-columns">Auditoría</th>
                    </tr>
                    <tr>
                      <th class="audit-columns">Creado por</th>
                      <th class="audit-columns">Fecha creación</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let item of pagos">
                      <td>
                        <a href="javascript:void(0)" title="Eliminar"
                           (click)="onEliminarPago(item)" [class.disabled]="onDeshabilitar(item.nro) ? true : null"
                           class="btn btn-raised btn-outline-danger btn-sm">
                          <i class="text-danger cursor-pointer" data-feather="trash-2"></i>
                        </a>
                      </td>
                      <td>{{item.nro}}</td>
                      <td>{{item.fechaConfirmada}}</td>
                      <td>
                        <div *ngIf="!item.flagPagoInteresConfirming">
                          {{item.fechaPago}}
                        </div>
                        <div class="cell-line-height" *ngIf="item.flagPagoInteresConfirming">
                          <p class="mb-25">
                            {{item.fechaPago}}
                          </p>
                          <span class="text-muted font-small-3">
                            <div class="badge badge-pill badge-glow badge-info">Intereses y gastos</div>
                          </span>
                        </div>
                      </td>
                      <td>{{(item.flagPagoInteresConfirming) ? '-' : item.diasMora | number: '1.0'}}</td>
                      <td>{{(item.flagPagoInteresConfirming) ? '-' : item.montoCobrar | number: '1.2-2'}}</td>
                      <td>{{item.montoPago | number: '1.2-2'}}</td>
                      <!--                      <td>{{item.fondoResguardoUsado | number: '1.2-2'}}</td>-->
                      <td>{{(item.flagPagoInteresConfirming) ? '-' : item.interes | number: '1.2-2'}}</td>
                      <td>{{(item.flagPagoInteresConfirming) ? '-' : item.gastos | number: '1.2-2'}}</td>
                      <td>{{(item.flagPagoInteresConfirming) ? '-' : item.saldoDeuda | number: '1.2-2'}}</td>
                      <td>{{item.exceso | number: '1.2-2'}}</td>
                      <td>{{item.tipoPago}}</td>
                      <td>{{item.observacion}}</td>
                      <td>
                        <i *ngIf="item.comprobanteGenerado1 === 1" class="text-success cursor-pointer fa fa-check"></i>
                        <i *ngIf="item.comprobanteGenerado1 === 0" class="text-danger cursor-pointer fa fa-ban"></i>
                        <i *ngIf="item.comprobanteGenerado1 === 2"
                           class="text-secondary cursor-pointer fa fa-minus-circle"></i>
                      </td>
                      <td>
                        <i *ngIf="item.comprobanteGenerado2 === 1" class="text-success cursor-pointer fa fa-check"></i>
                        <i *ngIf="item.comprobanteGenerado2 === 0" class="text-danger cursor-pointer fa fa-ban"></i>
                        <i *ngIf="item.comprobanteGenerado2 === 2"
                           class="text-secondary cursor-pointer fa fa-minus-circle"></i>
                      </td>
                      <td>{{item.usuarioCreacion}}</td>
                      <td>{{item.fechaCreacion}}</td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer" style="display: block !important;">
            <div class="row">
              <div class="col-md-12 col-12">
                <div style="float: right">
                  <button class="btn btn-secondary" rippleEffect type="button" (click)="onCancelarPago()">
                    <span [data-feather]="'x-circle'"></span> Cerrar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <ng-template #modalInicioPagos let-modal>
          <div class="modal-header">
            <h4 class="modal-title">Liquidación: [{{codigo}}]</h4>
            <button aria-label="Close" class="close" type="button" (click)="modal.dismiss()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" ngbAutofocus tabindex="0">
            <div class="table-responsive">
              <table class="table">
                <thead>
                <tr>
                  <th>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="customCheckS" unchecked
                             [(ngModel)]="seleccionarTodoInicioPagos" (ngModelChange)="onSeleccionarTodoInicioPagos()"/>
                      <label class="custom-control-label" for="customCheckS"></label>
                    </div>
                  </th>
                  <th style="text-align: center">¿Quién inició los pagos?</th>
                  <th>N° Documento</th>
                  <th>Fecha Confirmada</th>
                  <th>Neto Confirmado</th>
                  <th>Nota de crédito</th>
                  <th>Nueva factura</th>
                </tr>
                </thead>
                <tbody>
                <ng-template let-item ngFor [ngForOf]="inicioPagosRows">
                  <tr>
                    <td>
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input"
                               id="{{'customCheckS' + item.idLiquidacionDet}}" (change)="updateInicioPagosTotales()"
                               [disabled]="item.flagPagoHabilitado"
                               [(ngModel)]="item.seleccionado" (ngModelOptions)="{ standalone: true }"/>
                        <label class="custom-control-label" for="{{'customCheckS' + item.idLiquidacionDet}}"></label>
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <div class="form-control custom-control custom-switch custom-control-inline"
                             style="border: 0px; background-color: transparent">
                          <label style="padding-right: 0.5rem; line-height: 1.7rem">Pagador</label>
                          <input *ngIf="!item.flagPagoHabilitado" type="checkbox" class="custom-control-input"
                                 [(ngModel)]="item.flagInicioCliente" (change)="updateInicioPagosTotales()"
                                 id="flagInicioCliente{{item.idLiquidacionDet}}"/>
                          <input *ngIf="item.flagPagoHabilitado" type="checkbox" disabled class="custom-control-input"
                                 [(ngModel)]="item.flagInicioCliente" (change)="updateInicioPagosTotales()"
                                 id="flagInicioCliente{{item.idLiquidacionDet}}"/>
                          <label class="custom-control-label"
                                 for="flagInicioCliente{{item.idLiquidacionDet}}">Cliente</label>
                        </div>
                      </div>
                      <!--                      <div class="form-control custom-control custom-switch custom-control-inline"-->
                      <!--                           style="border: 0px; background-color: transparent">-->
                      <!--                        <label style="padding-right: 0.5rem; line-height: 1.7rem">Pagador</label>-->
                      <!--                        <input type="checkbox" class="custom-control-input" value="false"/>-->
                      <!--                        <label class="custom-control-label">Cliente</label>-->
                      <!--                      </div>-->
                    </td>
                    <td [ngClass]="{'pagoHabilitado': item.flagPagoHabilitado}">{{item.nroDocumento}}</td>
                    <td>{{item.fechaConfirmado}}</td>
                    <td>{{item.netoConfirmado | number: '1.2-2'}}</td>
                    <td>{{item.nroDocumento_NC}}</td>
                    <td>{{item.nroDocumento_FACT}}</td>
                  </tr>
                </ng-template>
                </tbody>
              </table>
            </div>
            <div class="row mt-1">
              <div class="col-12" *ngIf="this.countClienteSeleccionado > 0">
                <ngb-alert [type]="'info'" [dismissible]="false">
                  <div class="alert-body" style="font-size: 13px !important;">
                    * Se debe generar una NOTA DE CRÉDITO que esté vinculada a la factura de los intereses sin IGV del
                    servicio.<br>
                    * Se debe generar una NUEVA FACTURA por los intereses con IGV del servicio.<br>
                    * La DIFERENCIA en base a los nuevos intereses generados se AGREGARÁ A LA DEUDA.
                  </div>
                </ngb-alert>
              </div>
            </div>
          </div>
          <div class="modal-footer" style="display: block !important;">
            <div class="row">
              <div class="col-md-12 col-12">
                <div style="float: left">
                  <span style="font-weight: bold"> Total por pagador: {{countPagador | number}} </span><br>
                  <span style="font-weight: bold" class="mb-1"> Total por cliente: {{countCliente | number}} </span>
                </div>
                <div style="float: right" *ngIf="mostrar === 'true'">
                  <button class="btn btn-warning" rippleEffect type="button" (click)="onGuardarEstados()">
                    <span
                      [data-feather]="'settings'"></span> {{(countClienteSeleccionado > 0) ? 'Guardar estados y generar comprobante(s)' : 'Guardar estados'}}
                  </button>
                  &nbsp;
                  <!--                  (click)="onCancelarPago()"-->
                  <button class="btn btn-secondary" rippleEffect type="button" (click)="modal.dismiss()">
                    <span [data-feather]="'x-circle'"></span> Cerrar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <ng-template #modalPAI let-modal>
          <div class="modal-header">
            <h4 class="modal-title">Liquidación: [{{codigo}}]</h4>
            <button aria-label="Close" class="close" type="button" (click)="modal.dismiss()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" ngbAutofocus tabindex="0">
            <form [formGroup]="paiForm">
              <div class="row">
                <div class="col-12 mb-1">
                  <h4>Confirmación de pago de intereses y gastos (servicio)</h4>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Interés con IGV (servicio)</label>
                    <input class="form-control" formControlName="interesConIGV_Total" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Gastos con IGV (servicio)</label>
                    <input class="form-control" formControlName="gastosDiversosConIGV_Total" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-4 col-12">
                  <div class="form-group">
                    <label>Monto total a facturar</label>
                    <input class="form-control" formControlName="montoFacturado_Total" type="text"
                           mask="separator" thousandSeparator=","/>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Fecha Pago</label>
                    <div class="input-group">
                      <input class="form-control" placeholder="yyyy-mm-dd" formControlName="fecha_PAI"
                             [maxDate]="fechaMaxima"
                             [ngClass]="{ 'is-invalid': submitted && ReactiveIUFormPAI.fecha_PAI.errors }"
                             container="body" ngbDatepicker #basicDP1="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary feather icon-calendar"
                                (click)="basicDP1.toggle()"
                                type="button" rippleEffect></button>
                      </div>
                      <div *ngIf="ReactiveIUFormPAI.fecha_PAI.errors" class="invalid-feedback">
                        <div *ngIf="ReactiveIUFormPAI.fecha_PAI.errors?.required">* Campo obligatorio</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-12">
                  <div class="form-group">
                    <label>Monto Pago</label>
                    <input class="form-control" formControlName="monto_PAI" type="text"
                           [ngClass]="{ 'is-invalid': submitted && ReactiveIUFormPAI.monto_PAI.errors }"
                           mask="separator" thousandSeparator=","/>
                    <div *ngIf="ReactiveIUFormPAI.monto_PAI.errors" class="invalid-feedback">
                      <div *ngIf="ReactiveIUFormPAI.monto_PAI.errors?.required">* Campo obligatorio</div>
                      <div *ngIf="ReactiveIUFormPAI.monto_PAI.errors?.min">* El valor debe ser mayor a 0</div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label>Observación</label>
                    <textarea class="form-control" type="text" formControlName="observacion_PAI"
                              maxlength="200"></textarea>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer" style="display: block !important;">
            <div class="row">
              <div class="col-md-12 col-12" style="padding-left: 0px">
                <div style="float: left">
                  <ngb-alert *ngIf="!liquidacionCabItem.flagPagoInteresConfirming" [type]="'info'"
                             [dismissible]="false">
                    <div class="alert-body" style="font-size: 13px !important;">
                      * Por confirmar
                    </div>
                  </ngb-alert>
                  <ngb-alert *ngIf="liquidacionCabItem.flagPagoInteresConfirming" [type]="'success'"
                             [dismissible]="false">
                    <div class="alert-body" style="font-size: 13px !important;">
                      * Confirmado
                    </div>
                  </ngb-alert>
                </div>
                <div style="float: right" *ngIf="mostrar === 'true'">
                  <button [disabled]="liquidacionCabItem.flagPagoInteresConfirming" class="btn btn-warning" rippleEffect
                          type="button" (click)="onGuardarPAI()">
                    <span [data-feather]="'save'"></span> Guardar
                  </button>
                  &nbsp;
                  <button class="btn btn-secondary" rippleEffect type="button" (click)="modal.dismiss()">
                    <span [data-feather]="'x-circle'"></span> Cerrar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
    <block-ui></block-ui>
  </div>
</div>
